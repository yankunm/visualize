<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automated Essay Scoring</title>
</head>
<body>

  <h1>Graphically Modeling Persuasive Essays on ASAP Essay Dataset</h1>

  <!-- Dropdown menu for selecting HTML files -->
  <label for="fileSelector">Select an Essay:</label>
  <select id="fileSelector" onchange="loadFile()">
    <option value="">None</option>
  </select>

  <!-- iframe to display the selected HTML file -->
  <div>
    <iframe id="fileContent" width="1200" height="800" frameborder="0"></iframe>
  </div>
  
  <script>
    async function populateDropdown() {
        var select = document.getElementById("fileSelector");

        try {
            // Assume the files are in the "visualizations" directory
            const directoryPath = './visualizations/';

            // Fetch the list of files from the local directory
            const response = await fetchLocalFiles(directoryPath);

            // Extract file names from the HTML response
            const files = extractFileNames(response.responseText);
            console.log(files);

           // Populate dropdown with options, starting from the second file
            for (let i = 1; i < files.length; i++) {
                var option = document.createElement("option");
                option.value = directoryPath + files[i];
                option.text = "Essay " + files[i].match(/\d+/)[0];
                console.log(option.value);
                select.add(option);
            }
        } catch (error) {
            console.error('Error fetching file list:', error);
        }
    }

    function extractFileNames(htmlContent) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        const fileElements = doc.querySelectorAll('#files a');

        const files = Array.from(fileElements).map((fileElement) => {
            const fileName = fileElement.querySelector('.name').textContent;
            return fileName.trim();
        });

        return files;
    }

    async function fetchLocalFiles(directoryPath) {
        return new Promise((resolve, reject) => {
            // You can customize this to fit your needs
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        resolve(xhr);
                    } else {
                        reject(new Error(`Failed to fetch local files (status ${xhr.status})`));
                    }
                }
            };
            xhr.open('GET', directoryPath, true);
            xhr.send();
        });
    }

    // Function to load the selected HTML file into the iframe
    function loadFile() {
      var select = document.getElementById("fileSelector");
      var file = select.options[select.selectedIndex].value;

      // Set the iframe source to the selected HTML file
      document.getElementById("fileContent").src = file;
    }

    // Initial population of the dropdown
    populateDropdown().then(loadFile());

    async function readLocalJsonFile(filePath) {
      try {
          const xhr = await fetchLocalFiles(filePath);
          const jsonData = JSON.parse(xhr.responseText);
          console.log(jsonData);
          // Now you can work with the JSON data
      } catch (error) {
          console.error(error.message);
      }
  }

    // Example usage
    const localJsonFilePath = 'asap_essays.json';
    readLocalJsonFile(localJsonFilePath);
  </script>

</body>
</html>
